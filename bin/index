#!/usr/bin/env node

var fs = require('fs');
var path = require('path');

var compile = require('../index').compile;

var getPackage = () => {
  let content = fs.readFileSync('package.json', 'utf8');
  return JSON.parse(content) || null;
};

let pack = getPackage();
if (pack || !pack.gccmin) {
  let conf = pack.gccmin;
  let source = conf.source;
  if (!path.extname(source)) {
    source += '/main.js';
  }
  if (!fs.existsSync(source)) {
    throw new Error(`${source} could not be found.`);
  }

  let {
    repository,
    author,
    license,
    name,
    description,
    version
  } = pack;

  Object.assign(conf, {
    repository,
    author,
    license,
    name,
    description,
    version
  });

  conf.code = fs.readFileSync(source, 'utf8');

  let output = compile(conf);
  console.log(output);
}
